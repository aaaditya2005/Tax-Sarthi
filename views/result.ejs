<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tax Comparison Results</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
    <div class="min-h-screen flex items-center justify-center">
        <div class="bg-white shadow-lg rounded-lg w-full max-w-3xl p-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-4">Hello, <span class="text-blue-600"><%= user.name %></span></h1>

            <h2 class="text-xl font-semibold text-gray-700 mb-6">Here is your tax saving comparison:</h2>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div class="bg-gray-50 p-4 rounded-md shadow-md">
                    <h3 class="text-lg font-bold text-gray-600">Old Tax Regime</h3>
                    <%
    const salary = parseFloat(formData.salary || 0);
    const businessIncome = parseFloat(formData.business_income || 0);
    const rentalIncome = parseFloat(formData.rental_income || 0);
    const otherIncome = parseFloat(formData.other_income || 0);
    const savingInterest = parseFloat(formData.saving_interest || 0);
    const capitalGains = parseFloat(formData.capital_gains || 0);
    const hra = parseFloat(formData.hra || 0);
    const hraDeduction = (businessIncome = 0) ? (0.5 * salary) : hra;

    const businessdeductions = (hra > 0.5 * salary) ? 0 : parseFloat(formData.depreciation_assets || 0) +
    parseFloat(formData.expenditure_scientific_research || 0) +
    parseFloat(formData.deduction_new_employment || 0) +
    parseFloat(formData.presumptive_taxation_small_businesses || 0) +
    parseFloat(formData.presumptive_taxation_professionals || 0) +
    parseFloat(formData.donations_charitable_institutions || 0) +
    parseFloat(formData.infrastructure_development || 0) +
    parseFloat(formData.specific_business_expenditures || 0) +
    parseFloat(formData.general_business_expenditures || 0); 
    const deductions = hraDeduction +
        parseFloat(formData.lta || 0) +
        parseFloat(formData.cea || 0) +
        parseFloat(formData.ta || 0) +
        parseFloat(formData.saving_interest_deductions || 0) +
        parseFloat(formData.professional_allowance || 0) +
        parseFloat(formData.uniform_allowance || 0) +
        parseFloat(formData.lip || 0) +
        parseFloat(formData.epf || 0) +
        parseFloat(formData.ppf || 0) +
        parseFloat(formData.nsc || 0) +
        parseFloat(formData.ssy || 0) +
        parseFloat(formData.fd || 0) +
        parseFloat(formData.elss || 0) +
        parseFloat(formData.NPS || 0) +
        parseFloat(formData.medical || 0) +
        parseFloat(formData.medicaldisability || 0) +
        parseFloat(formData.specialdiseases || 0) +
        parseFloat(formData.eduloan || 0) +
        parseFloat(formData.homeloan || 0) +
        parseFloat(formData.firsthome || 0) +
        parseFloat(formData.ev || 0) +
        parseFloat(formData.donations || 0) +
        if(hra==0) {parseFloat(formData.houserent || 0)} +
        parseFloat(formData.disability_individuals || 0) +
        parseFloat(formData.donations_scientific_rural_development || 0) +
        parseFloat(formData.donations_companies_political_parties || 0) +
        parseFloat(formData.donations_individuals_political_parties || 0) + businessdeductions ;
    const deudctionsnew = parseFloat(formData.NPS || 0) + parseFloat(formData.tad || 0);
    const totalIncome = salary + businessIncome + rentalIncome + otherIncome + savingInterest + capitalGains;
    const taxableincomeold = totalIncome - deductions - 50000;
    const taxableincomenew = totalIncome - deductions - 75000;
%>

<p class="mt-2 text-gray-700">
    Income: ₹<%= totalIncome.toFixed(2) %>
</p>
<p class="mt-1 text-gray-700">
    Deductions: ₹<%= deductions.toFixed(2) %>
</p>
<p class="mt-1 text-gray-700">
    Taxable Income: ₹<%= taxableincomeold.toFixed(2) %>
</p>
<%
    const age = calculateAge(user.dob);
    let taxPayable = 0;

    if (age < 60) {
        if (taxableincomeold <= 250000) {
            taxPayable = 0;
        } else if (taxableincomeold <= 500000) {
            taxPayable = 0;
        } else if (taxableincomeold <= 1000000) {
            taxPayable = (500000 - 250000) * 0.05 + (taxableincomeold - 500000) * 0.20;
        } else {
            taxPayable = (500000 - 250000) * 0.05 + (1000000 - 500000) * 0.20 + (taxableincomeold - 1000000) * 0.30;
        }
    } else if (age < 80) {
        if (taxableincomeold <= 300000) {
            taxPayable = 0;
        } else if (taxableincomeold <= 500000) {
            taxPayable = 0;
        } else if (taxableincomeold <= 1000000) {
            taxPayable = (500000 - 300000) * 0.05 + (taxableincomeold - 500000) * 0.20;
        } else {
            taxPayable = (500000 - 300000) * 0.05 + (1000000 - 500000) * 0.20 + (taxableincomeold - 1000000) * 0.30;
        }
    } else {
        if (taxableincomeold <= 500000) {
            taxPayable = 0;
        } else if (taxableincomeold <= 1000000) {
            taxPayable = (taxableincomeold - 500000) * 0.20;
        } else {
            taxPayable = (1000000 - 500000) * 0.20 + (taxableincomeold - 1000000) * 0.30;
        }
    }
%>

<p class="mt-1 text-gray-700">
    Tax Payable: ₹<%= taxPayable.toFixed(2) %>
</p>


                </div>
                <div class="bg-gray-50 p-4 rounded-md shadow-md">
                    <h3 class="text-lg font-bold text-gray-600">New Tax Regime</h3>
                    <p class="mt-2 text-gray-700">
                        Income: ₹<%= totalIncome.toFixed(2) %>
                    </p>
                    <p class="mt-1 text-gray-700">Deductions: Not applicable</p>
                    <p class="mt-1 text-gray-700">
                        Taxable Income: ₹<%= taxableincomenew.toFixed(2) %>
                    </p>
                    <%
                    let taxPayablenew = 0;
                
                    // Tax Calculation based on tax slabs
                    if (taxableincomeold <= 300000) {
                        taxPayablenew = 0;
                    } else if (taxableincomeold <= 700000) {
                        taxPayablenew = 0;
                    } else if (taxableincomeold <= 1000000) {
                        taxPayablenew = (700000 - 300000) * 0.05 + (taxableincomeold - 700000) * 0.10;
                    } else if (taxableincomeold <= 1200000) {
                        taxPayablenew = (700000 - 300000) * 0.05 + (1000000 - 700000) * 0.10 + (taxableincomeold - 1000000) * 0.15;
                    } else if (taxableincomeold <= 1500000) {
                        taxPayablenew = (700000 - 300000) * 0.05 + (1000000 - 700000) * 0.10 + (1200000 - 1000000) * 0.15 + (taxableincomeold - 1200000) * 0.20;
                    } else {
                        taxPayablenew = (700000 - 300000) * 0.05 + (1000000 - 700000) * 0.10 + (1200000 - 1000000) * 0.15 + (1500000 - 1200000) * 0.20 + (taxableincomeold - 1500000) * 0.30;
                    }
                %>
                
                    <p class="mt-1 text-gray-700">Tax Payable: ₹<%= taxPayablenew %></p>
                </div>
            </div>

            <div class="mt-6 p-4 bg-green-100 border-l-4 border-green-500 text-green-700">
                <p class="font-semibold">Tax Saved:</p>
                <p class="text-lg">₹<%=  %></p>
            </div>

            <div class="mt-8 text-center">
                <a href="/tool" class="text-blue-600 hover:underline">Go Back to Tool</a>
            </div>
        </div>
    </div>
</body>
</html>
